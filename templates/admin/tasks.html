{% extends "admin_base.html" %} {% block title %}Task Manager{% endblock %} {%
block page_title %}Manage Tasks{% endblock %} {% block content %}
<div x-data="{ showCreate: false }">
  <button
    @click="showCreate = !showCreate"
    class="btn"
    style="background: var(--primary); color: black; margin-bottom: 2rem"
  >
    <i class="fas fa-plus"></i> Create New Task
  </button>

  <!-- Create Form -->
  <div x-show="showCreate" x-collapse style="margin-bottom: 2rem">
    <div class="glass-panel" style="padding: 2rem">
      <h3 style="margin-bottom: 1.5rem">New Task Details</h3>
      <form
        action="{{ url_for('admin_tasks') }}"
        method="POST"
        enctype="multipart/form-data"
      >
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
          "
        >
          <div>
            <label
              style="
                display: block;
                color: var(--text-muted);
                margin-bottom: 5px;
              "
              >Task Title</label
            >
            <input
              type="text"
              name="title"
              required
              class="form-input"
              style="
                width: 100%;
                padding: 10px;
                background: rgba(0, 0, 0, 0.2);
                border: 1px solid var(--glass-border);
                border-radius: 8px;
                color: white;
              "
            />
          </div>
          <div>
            <label
              style="
                display: block;
                color: var(--text-muted);
                margin-bottom: 5px;
              "
              >Deadline</label
            >
            <input
              type="date"
              name="deadline"
              required
              class="form-input"
              style="
                width: 100%;
                padding: 10px;
                background: rgba(0, 0, 0, 0.2);
                border: 1px solid var(--glass-border);
                border-radius: 8px;
                color: white;
              "
            />
          </div>
        </div>

        <div style="margin-bottom: 1.5rem">
          <label
            style="display: block; color: var(--text-muted); margin-bottom: 5px"
            >Description</label
          >
          <textarea
            name="description"
            rows="3"
            required
            style="
              width: 100%;
              padding: 10px;
              background: rgba(0, 0, 0, 0.2);
              border: 1px solid var(--glass-border);
              border-radius: 8px;
              color: white;
            "
          ></textarea>
        </div>

        <div
          style="
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
          "
        >
          <div>
            <label
              style="
                display: block;
                color: var(--text-muted);
                margin-bottom: 5px;
              "
              >Priority</label
            >
            <select
              name="priority"
              style="
                width: 100%;
                padding: 10px;
                background: rgba(0, 0, 0, 0.2);
                border: 1px solid var(--glass-border);
                border-radius: 8px;
                color: white;
              "
            >
              <option value="LOW">Low</option>
              <option value="MEDIUM">Medium</option>
              <option value="HIGH">High</option>
            </select>
          </div>
          <div>
            <label
              style="
                display: block;
                color: var(--text-muted);
                margin-bottom: 5px;
              "
              >Category</label
            >
            <select
              name="category"
              style="
                width: 100%;
                padding: 10px;
                background: rgba(0, 0, 0, 0.2);
                border: 1px solid var(--glass-border);
                border-radius: 8px;
                color: white;
              "
            >
              <option value="Development">Development</option>
              <option value="Design">Design</option>
              <option value="Research">Research</option>
              <option value="HR">HR</option>
            </select>
          </div>
          <div>
            <label
              style="
                display: block;
                color: var(--text-muted);
                margin-bottom: 5px;
              "
              >Assigned To (ID)</label
            >
            <input
              type="text"
              name="assigned_to"
              placeholder="Leave empty for all"
              style="
                width: 100%;
                padding: 10px;
                background: rgba(0, 0, 0, 0.2);
                border: 1px solid var(--glass-border);
                border-radius: 8px;
                color: white;
              "
            />
          </div>
        </div>

        <button
          type="submit"
          class="btn"
          style="background: var(--success); color: white"
        >
          Publish Task
        </button>
      </form>
    </div>
  </div>

  <!-- Task List -->
  <h3 style="margin-bottom: 1rem">Active Tasks</h3>
  <div style="display: grid; gap: 1rem">
    {% if tasks %} {% for task in tasks %}
    <div
      class="glass-panel"
      style="
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      "
    >
      <div>
        <div style="display: flex; align-items: center; gap: 10px">
          <h4 style="margin: 0">{{ task.title }}</h4>
          <span
            style="font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: {{ 'var(--danger)' if task.priority == 'HIGH' else 'rgba(255,255,255,0.1)' }};"
            >{{ task.priority }}</span
          >
        </div>
        <p style="color: var(--text-muted); font-size: 0.9rem; margin: 5px 0 0">
          Due: {{ task.deadline }} &bull; {{ task.category }}
        </p>
      </div>
      <form
        action="{{ url_for('delete_task', task_id=task.id) }}"
        method="POST"
        onsubmit="return confirm('Delete this task?');"
      >
        <button
          type="submit"
          class="btn"
          style="background: rgba(239, 68, 68, 0.2); color: var(--danger)"
        >
          <i class="fas fa-trash"></i>
        </button>
      </form>
    </div>
    {% endfor %} {% else %}
    <div style="text-align: center; color: var(--text-muted); padding: 2rem">
      No active tasks.
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
