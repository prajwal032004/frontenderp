{% extends "intern_base.html" %} {% block title %}Leave Requests{% endblock %}
{% block page_title %}Leave Management{% endblock %} {% block extra_head %}
<style>
  .leave-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 1.2rem;
    margin-bottom: 1rem;
    transition: 0.3s;
  }
  .leave-card:hover {
    background: rgba(255, 255, 255, 0.06);
  }

  .date-box {
    background: var(--glass-surface);
    padding: 8px 16px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid var(--glass-border);
    margin-right: 1rem;
  }
  .status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }
  .status-PENDING {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
  }
  .status-APPROVED {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
  }
  .status-REJECTED {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
  }

  .add-btn {
    background: var(--primary);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 1.5rem;
    box-shadow: 0 4px 15px var(--primary-glow);
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 90;
    cursor: pointer;
  }
</style>
{% endblock %} {% block content %}
<div x-data="{ showModal: false }">
  <!-- Header Summary -->
  <div
    style="
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    "
  >
    <div
      class="glass-panel"
      style="padding: 1rem; border-radius: 12px; text-align: center"
    >
      <span style="font-size: 2rem; font-weight: 700"
        >{{ leave_requests|selectattr('status', 'equalto',
        'APPROVED')|list|length }}</span
      >
      <p style="color: var(--text-muted); font-size: 0.8rem">Total Approved</p>
    </div>
    <div
      class="glass-panel"
      style="padding: 1rem; border-radius: 12px; text-align: center"
    >
      <span style="font-size: 2rem; font-weight: 700; color: #f59e0b"
        >{{ leave_requests|selectattr('status', 'equalto',
        'PENDING')|list|length }}</span
      >
      <p style="color: var(--text-muted); font-size: 0.8rem">Pending Review</p>
    </div>
    <div
      class="glass-panel"
      style="padding: 1rem; border-radius: 12px; text-align: center"
    >
      <button
        @click="showModal = true"
        style="
          width: 100%;
          height: 100%;
          background: var(--primary);
          border: none;
          color: white;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
        "
      >
        <i class="fas fa-plus"></i> New Request
      </button>
    </div>
  </div>

  <!-- History List -->
  <div class="glass-panel" style="padding: 2rem; border-radius: 20px">
    <h3 style="margin-bottom: 1.5rem">Request History</h3>

    {% if leave_requests %} {% for leave in leave_requests %}
    <div class="leave-card">
      <div style="display: flex; align-items: center">
        <div class="date-box">
          <div style="font-size: 0.8rem; color: var(--text-muted)">
            {{ leave.start_date }}
          </div>
          <div style="font-weight: 700">TO</div>
          <div style="font-size: 0.8rem; color: var(--text-muted)">
            {{ leave.end_date }}
          </div>
        </div>
        <div>
          <h4 style="font-size: 1rem; font-weight: 600">
            {{ leave.leave_type }}
          </h4>
          <p style="color: var(--text-muted); font-size: 0.85rem">
            {{ leave.reason }}
          </p>
        </div>
      </div>
      <span class="status-badge status-{{ leave.status }}"
        >{{ leave.status }}</span
      >
    </div>
    {% endfor %} {% else %}
    <div style="text-align: center; padding: 2rem; color: var(--text-muted)">
      <i
        class="fas fa-mug-hot"
        style="font-size: 2rem; margin-bottom: 10px"
      ></i>
      <p>No leave requests found.</p>
    </div>
    {% endif %}
  </div>

  <!-- Floating Add Button (Mobile) -->
  <button class="add-btn" @click="showModal = true" style="display: none">
    +
  </button>

  <!-- Modal -->
  <div
    x-show="showModal"
    style="
      position: fixed;
      inset: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
    "
    x-cloak
  >
    <div
      class="glass-panel"
      style="
        width: 90%;
        max-width: 500px;
        border-radius: 20px;
        padding: 2rem;
        background: var(--bg-body);
        border: 1px solid var(--glass-border);
      "
      @click.away="showModal = false"
    >
      <h3 style="margin-bottom: 1.5rem">Request Leave</h3>

      <form action="{{ url_for('intern_leave') }}" method="POST">
        <div style="margin-bottom: 1rem">
          <label
            style="display: block; color: var(--text-muted); margin-bottom: 5px"
            >Leave Type</label
          >
          <select
            name="leave_type"
            style="
              width: 100%;
              padding: 10px;
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid var(--glass-border);
              border-radius: 8px;
              color: var(--text-main);
            "
          >
            <option value="Sick Leave">Sick Leave</option>
            <option value="Casual Leave">Casual Leave</option>
            <option value="Emergency">Emergency</option>
          </select>
        </div>

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
          "
        >
          <div>
            <label
              style="
                display: block;
                color: var(--text-muted);
                margin-bottom: 5px;
              "
              >Start Date</label
            >
            <input
              type="date"
              name="start_date"
              style="
                width: 100%;
                padding: 10px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid var(--glass-border);
                border-radius: 8px;
                color: var(--text-main);
              "
              required
            />
          </div>
          <div>
            <label
              style="
                display: block;
                color: var(--text-muted);
                margin-bottom: 5px;
              "
              >End Date</label
            >
            <input
              type="date"
              name="end_date"
              style="
                width: 100%;
                padding: 10px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid var(--glass-border);
                border-radius: 8px;
                color: var(--text-main);
              "
              required
            />
          </div>
        </div>

        <div style="margin-bottom: 1.5rem">
          <label
            style="display: block; color: var(--text-muted); margin-bottom: 5px"
            >Reason</label
          >
          <textarea
            name="reason"
            rows="3"
            style="
              width: 100%;
              padding: 10px;
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid var(--glass-border);
              border-radius: 8px;
              color: var(--text-main);
            "
            placeholder="Why do you need leave?"
            required
          ></textarea>
        </div>

        <div style="display: flex; justify-content: flex-end; gap: 1rem">
          <button
            type="button"
            @click="showModal = false"
            style="
              background: transparent;
              border: 1px solid var(--glass-border);
              color: var(--text-muted);
              padding: 8px 16px;
              border-radius: 8px;
              cursor: pointer;
            "
          >
            Cancel
          </button>
          <button
            type="submit"
            style="
              background: var(--primary);
              border: none;
              color: white;
              padding: 8px 20px;
              border-radius: 8px;
              cursor: pointer;
            "
          >
            Submit Request
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
